<!-- views/admin.ejs -->
<!DOCTYPE html>
<html lang="zh-CN" x-data="{ activeTab: 'node' }">
<%- include('partials/head') %>
<body x-cloak>
  <%- include('partials/nav') %>

  <main class="container">
    <div class="admin-header">
      <h2>节点管理</h2>
      <div class="node-count">节点总数: <%= nodes.length %></div>
    </div>

    <div class="card">
      <h3>添加新节点</h3>
      <form method="post" action="/add" class="form">
        <div class="tab-control">
          <button 
            type="button"
            @click="activeTab = 'node'"
            :class="activeTab === 'node' ? 'active' : ''"
          >单个节点</button>
          <button 
            type="button"
            @click="activeTab = 'sub'"
            :class="activeTab === 'sub' ? 'active' : ''"
          >订阅链接</button>
        </div>

        <div x-show="activeTab === 'node'">
          <label>节点链接</label>
          <textarea
            name="content"
            rows="4"
            class="input-field"
            placeholder="ss://、vmess:// 等格式..."
          ></textarea>
          <input type="hidden" name="type" value="node">
        </div>

        <div x-show="activeTab === 'sub'">
          <label>订阅链接</label>
          <input
            type="url"
            name="content"
            class="input-field"
            placeholder="https://example.com/sub"
          >
          <input type="hidden" name="type" value="subscription">
        </div>

        <button type="submit" class="btn btn-primary">添加节点</button>
      </form>
    </div>

    <div class="table-container">
      <table class="node-table">
        <thead>
          <tr>
            <th>类型</th>
            <th>节点配置</th>
            <th>创建时间</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <% nodes.forEach(node => { 
            const cfg = JSON.parse(node.config) %>
            <tr>
              <td>
                <span class="node-type <%= node.type %>">
                  <%= node.type.toUpperCase() %>
                </span>
              </td>
              <td>
                <div class="node-info">
                  <div class="node-name"><%= cfg.ps %></div>
                  <div class="node-address"><%= cfg.add %>:<%= cfg.port %></div>
                </div>
              </td>
              <td>
                <%= new Date(node.created_at).toLocaleDateString() %>
              </td>
              <td>
                <button class="delete-btn">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </main>
</body>
</html>
